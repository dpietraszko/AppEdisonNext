"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=t(require("axios")),r=t(require("axios/lib/adapters/http")),n=t(require("lodash/mapKeys")),o=t(require("lodash/snakeCase")),s=t(require("lodash/camelCase")),i=t(require("lodash/forEach")),c=t(require("lodash/isArray")),u=t(require("lodash/isDate")),a=t(require("lodash/isObject")),p=require("querystring"),l=t(require("lodash/mapValues")),h=t(require("fs")),m=t(require("form-data"));function f(){return(f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function g(t,e,r){return(g=y()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&P(o,r.prototype),o}).apply(null,arguments)}function j(t){var e="function"==typeof Map?new Map:void 0;return(j=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return g(t,arguments,v(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),P(r,t)})(t)}var C=function(t){return n(t,(function(t,e){return s(e)}))},b=function(t){var e=C(t);return i(e,(function(t,r){u(t)||(c(t)?e[r]=t.map((function(t){return a(t)&&!u(t)?C(t):t})):a(t)&&(e[r]=C(t)))})),e},w=function(t){var e=t.data;return e?c(e)?e.map(b):function(t){return!!t.collection&&!!t.size}(e)?f({},e,{collection:e.collection.map(b)}):function(t){return!!t.list&&!!t.count}(e)?f({},e,{list:e.list.map(b)}):b(e):e},S=function(t){this.httpClient=t},_=function(t){return t.toISOString().slice(0,10)},D=function(t){return n(t,(function(t,e){return o(e)}))},O=function(t){var e=t.data,r=t.params;if(["get","delete"].includes(t.method.toLowerCase())){var n=l(r,(function(t,e){return"birthdayDate"===e?c(t)?t.map(_):_(t):t}));return f({},t,{params:n=D(n),paramsSerializer:function(t){return p.stringify(t)}})}return e?f({},t,{data:p.stringify(D(e))}):t},R=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.httpClient.get("/contacts/groups"))}catch(t){return Promise.reject(t)}},r.getById=function(t){try{return Promise.resolve(this.httpClient.get("/contacts/groups/"+t))}catch(t){return Promise.reject(t)}},r.create=function(t,e){try{return Promise.resolve(this.httpClient.post("/contacts/groups",f({name:t},e)))}catch(t){return Promise.reject(t)}},r.update=function(t,e){try{return Promise.resolve(this.httpClient.put("/contacts/groups/"+t,e))}catch(t){return Promise.reject(t)}},r.remove=function(t,e){void 0===e&&(e=!1);try{return Promise.resolve(this.httpClient.delete("/contacts/groups/"+t,{params:{deleteContacts:e}})).then((function(){}))}catch(t){return Promise.reject(t)}},e}(S),F=function(t){return t.date_created||t.date_updated?f({},t,{date_created:new Date(t.date_created),date_updated:new Date(t.date_updated)}):f({},t)},H=function(t){var e=t.data;return function(t){return!!t.size&&!!t.collection}(e)?f({},t,{data:{collection:e.collection.map((function(t){return F(t)})),size:e.size}}):f({},t,{data:F(e)})},V=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.httpClient.get("/contacts/fields"))}catch(t){return Promise.reject(t)}},r.create=function(t,e){void 0===e&&(e="text");try{return Promise.resolve(this.httpClient.post("/contacts/fields",{name:t,type:e}))}catch(t){return Promise.reject(t)}},r.update=function(t,e){try{return Promise.resolve(this.httpClient.put("/contacts/fields/"+t,{name:e}))}catch(t){return Promise.reject(t)}},r.remove=function(t){try{return Promise.resolve(this.httpClient.delete("/contacts/fields/"+t)).then((function(){}))}catch(t){return Promise.reject(t)}},e}(S),q=function(t){function r(r){var n;return(n=t.call(this,r)||this).contactHttpClient=e.create({adapter:r.defaults.adapter,baseURL:r.defaults.baseURL,headers:r.defaults.headers}),n.contactHttpClient.interceptors.request.use(O),n.contactHttpClient.interceptors.response.use(H),n.contactHttpClient.interceptors.response.use(w),n.fields=new V(n.contactHttpClient),n.groups=new R(n.contactHttpClient),n}d(r,t);var s=r.prototype;return s.get=function(t){try{return Promise.resolve(this.contactHttpClient.get("/contacts",{params:t}))}catch(t){return Promise.reject(t)}},s.getById=function(t){try{return Promise.resolve(this.contactHttpClient.get("/contacts/"+t))}catch(t){return Promise.reject(t)}},s.create=function(t,e){try{return Promise.resolve(this.contactHttpClient.post("/contacts",f({phone_number:t},this.formatContactDetails(e||{}))))}catch(t){return Promise.reject(t)}},s.update=function(t,e){try{return Promise.resolve(this.contactHttpClient.put("/contacts/"+t,f({},this.formatContactDetails(e||{}))))}catch(t){return Promise.reject(t)}},s.remove=function(t){try{return Promise.resolve(this.contactHttpClient.delete("/contacts/"+t)).then((function(){}))}catch(t){return Promise.reject(t)}},s.getGroups=function(t){try{return Promise.resolve(this.contactHttpClient.get("/contacts/"+t+"/groups"))}catch(t){return Promise.reject(t)}},s.getGroupById=function(t,e){try{return Promise.resolve(this.contactHttpClient.get("/contacts/"+t+"/groups/"+e))}catch(t){return Promise.reject(t)}},s.assignContactToGroup=function(t,e){try{return Promise.resolve(this.contactHttpClient.put("/contacts/"+t+"/groups/"+e))}catch(t){return Promise.reject(t)}},s.unpinContactFromGroup=function(t,e){try{return Promise.resolve(this.contactHttpClient.delete("/contacts/"+t+"/groups/"+e)).then((function(){}))}catch(t){return Promise.reject(t)}},s.formatContactDetails=function(t){var e=t;return t.birthdayDate&&(e.birthdayDate=_(t.birthdayDate)),n(e,(function(t,e){return o(e)}))},r}(S),T=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.check=function(t,e){try{var r={number:c(t)?t.join(","):t};return e&&(r.idx=c(e)?e.join(","):e),Promise.resolve(this.httpClient.get("/hlr.do",{params:f({format:"json"},r)}))}catch(t){return Promise.reject(t)}},e}(S);function x(t){return void 0!==t.error&&void 0!==t.message}var L=function(t){function e(e){var r;return r=t.call(this)||this,Error.captureStackTrace(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r),r.constructor),r.name="MessageError",r.data=e,r}return d(e,t),e}(j(Error)),G=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.send=function(t,e,r){try{var n=function(t){return o?t:Promise.resolve(s.httpClient.post(s.endpoint,i)).then((function(t){if(x(t))throw new L(t);return s.formatResponse(t)}))},o=!1,s=this,i=f({details:!0,encoding:"utf-8",format:"json"},s.formatSmsDetails(r||{}));if(s.isNumberRecipient(e)){var u=e.to;i.to=c(u)?u.join(","):u}if(s.isGroupRecipient(e)){var a=e.group;i.group=c(a)?a.join(","):a}s.isSms(t)&&(i.message=t.message.trim()),s.isMms(t)&&(i.subject=t.subject.trim(),i.smil=t.smil),s.isVmsText(t)&&(i.tts=t.tts.trim(),i.tts_lector=t.ttsLector||"ewa"),s.isVmsRemotePath(t)&&(i.file=t.remotePath);var p=function(){if(s.isVmsLocalFile(t)){var e=s.getFormDataForVmsLocalFile(i,t);return Promise.resolve(s.httpClient.post(s.endpoint,e.getBuffer(),{headers:e.getHeaders()})).then((function(t){if(x(t))throw new L(t);return o=!0,s.formatResponse(t)}))}}();return Promise.resolve(p&&p.then?p.then(n):n(p))}catch(t){return Promise.reject(t)}},r.isNumberRecipient=function(t){return void 0!==t.to},r.isGroupRecipient=function(t){return void 0!==t.group},r.isSms=function(t){return void 0!==t.message},r.isMms=function(t){return void 0!==t.smil&&void 0!==t.subject},r.isVmsText=function(t){return void 0!==t.tts},r.isVmsLocalFile=function(t){return void 0!==t.localPath},r.isVmsRemotePath=function(t){return void 0!==t.remotePath},r.getFormDataForVmsLocalFile=function(t,e){var r=new m;t.to&&r.append("to",t.to),t.group&&r.append("group",t.group);for(var n=0,o=Object.entries(t);n<o.length;n++){var s=o[n],i=s[1];r.append(s[0],"boolean"!=typeof i?i:i?1:0)}return r.append("file",h.readFileSync(e.localPath),{contentType:"audio/wav",filename:"vms.wav"}),r},r.formatSmsDetails=function(t){var e=t;return t.date&&(e.dateValidate=!0,e.date=t.date.toISOString()),t.expirationDate&&(e.expirationDate=t.expirationDate.toISOString()),n(e,(function(t,e){return/param[1-4]/.test(e)?e:"noUnicode"===e?e.toLowerCase():o(e)}))},r.formatResponse=function(t){return f({},t,{list:t.list.map((function(t){return f({},t,{dateSent:new Date(t.dateSent),points:"string"==typeof t.points?parseFloat(t.points):t.points})}))})},e}(S),A=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).endpoint="/mms.do",e}d(e,t);var r=e.prototype;return r.sendMms=function(t,e,r,n){try{return Promise.resolve(this.send({smil:r,subject:e},{to:t},n))}catch(t){return Promise.reject(t)}},r.sendMmsToGroup=function(t,e,r,n){try{return Promise.resolve(this.send({smil:r,subject:e},{group:t},n))}catch(t){return Promise.reject(t)}},e}(G),M=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.get=function(){try{return Promise.resolve(this.httpClient.get("/profile"))}catch(t){return Promise.reject(t)}},e}(S),I=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.get=function(){try{var t=this;return Promise.resolve(t.httpClient.get("/sms/sendernames")).then((function(e){return f({},e,{collection:e.collection.map(t.formatSendernameDates)})}))}catch(t){return Promise.reject(t)}},r.getBySender=function(t){try{var e=this;return Promise.resolve(e.httpClient.get("/sms/sendernames/"+t)).then((function(t){return e.formatSendernameDates(t)}))}catch(t){return Promise.reject(t)}},r.create=function(t){try{var e=this;return Promise.resolve(e.httpClient.post("/sms/sendernames",{sender:t})).then((function(t){return e.formatSendernameDates(t)}))}catch(t){return Promise.reject(t)}},r.makeDefault=function(t){try{return Promise.resolve(this.httpClient.post("/sms/sendernames/"+t+"/commands/make_default")).then((function(){}))}catch(t){return Promise.reject(t)}},r.remove=function(t){try{return Promise.resolve(this.httpClient.delete("/sms/sendernames/"+t)).then((function(){}))}catch(t){return Promise.reject(t)}},r.formatSendernameDates=function(t){return f({},t,{createdAt:new Date(t.createdAt)})},e}(S),B=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).endpoint="/sms.do",e}d(e,t);var r=e.prototype;return r.sendSms=function(t,e,r){try{return Promise.resolve(this.send({message:e},{to:t},r))}catch(t){return Promise.reject(t)}},r.sendFlashSms=function(t,e,r){try{return Promise.resolve(this.sendSms(t,e,f({},r,{flash:!0})))}catch(t){return Promise.reject(t)}},r.sendSmsToGroup=function(t,e,r){try{return Promise.resolve(this.send({message:e},{group:t},r))}catch(t){return Promise.reject(t)}},r.sendFlashSmsToGroup=function(t,e,r){try{return Promise.resolve(this.sendSmsToGroup(t,e,f({},r,{flash:!0})))}catch(t){return Promise.reject(t)}},r.removeScheduledSms=function(t){try{var e=c(t)?t.join(","):t;return Promise.resolve(this.httpClient.post(this.endpoint,{format:"json",sch_del:e}))}catch(t){return Promise.reject(t)}},e}(G),k=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.httpClient.get("/subusers"))}catch(t){return Promise.reject(t)}},r.getById=function(t){try{return Promise.resolve(this.httpClient.get("/subusers/"+t))}catch(t){return Promise.reject(t)}},r.create=function(t){try{var e=t.credentials,r=t.points;return Promise.resolve(this.httpClient.post("/subusers",f({},t,{credentials:{api_password:e.apiPassword,password:e.password,username:e.username},points:r?{from_account:r.fromAccount,per_month:r.perMonth}:void 0})))}catch(t){return Promise.reject(t)}},r.update=function(t,e){try{var r=e.credentials,n=e.points;return Promise.resolve(this.httpClient.put("/subusers/"+t,f({},e,{credentials:r&&(r.password||r.apiPassword)?{api_password:r.apiPassword,password:r.password}:void 0,points:n&&(n.fromAccount||n.perMonth)?{from_account:n.fromAccount,per_month:n.perMonth}:void 0})))}catch(t){return Promise.reject(t)}},r.remove=function(t){try{return Promise.resolve(this.httpClient.delete("/subusers/"+t)).then((function(){}))}catch(t){return Promise.reject(t)}},e}(S),U=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.httpClient.get("/sms/templates"))}catch(t){return Promise.reject(t)}},r.getById=function(t){try{return Promise.resolve(this.httpClient.get("/sms/templates/"+t))}catch(t){return Promise.reject(t)}},r.create=function(t){try{return Promise.resolve(this.httpClient.post("/sms/templates",t))}catch(t){return Promise.reject(t)}},r.update=function(t,e){try{return Promise.resolve(this.httpClient.put("/sms/templates/"+t,e))}catch(t){return Promise.reject(t)}},r.remove=function(t){try{return Promise.resolve(this.httpClient.delete("/sms/templates/"+t)).then((function(){}))}catch(t){return Promise.reject(t)}},e}(S),z=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).endpoint="/vms.do",e}d(e,t);var r=e.prototype;return r.sendVms=function(t,e,r,n){try{return Promise.resolve(this.send({tts:e,ttsLector:r},{to:t},n))}catch(t){return Promise.reject(t)}},r.sendVmsWithLocalFile=function(t,e,r){try{return Promise.resolve(this.send({localPath:e},{to:t},r))}catch(t){return Promise.reject(t)}},r.sendVmsWithRemoteFile=function(t,e,r){try{return Promise.resolve(this.send({remotePath:e},{to:t},r))}catch(t){return Promise.reject(t)}},r.sendVmsToGroup=function(t,e,r,n){try{return Promise.resolve(this.send({tts:e,ttsLector:r},{group:t},n))}catch(t){return Promise.reject(t)}},r.sendVmsWithLocalFileToGroup=function(t,e,r){try{return Promise.resolve(this.send({localPath:e},{group:t},r))}catch(t){return Promise.reject(t)}},r.sendVmsWithRemoteFileToGroup=function(t,e,r){try{return Promise.resolve(this.send({remotePath:e},{group:t},r))}catch(t){return Promise.reject(t)}},e}(G);exports.SMSAPI=function(){function t(t){this.accessToken=t,this.httpClient=this.setHttpClient(),this.contacts=new q(this.httpClient),this.hlr=new T(this.httpClient),this.mms=new A(this.httpClient),this.profile=new M(this.httpClient),this.sendernames=new I(this.httpClient),this.sms=new B(this.httpClient),this.subusers=new k(this.httpClient),this.templates=new U(this.httpClient),this.vms=new z(this.httpClient)}var n=t.prototype;return n.getUserAgent=function(){return"smsapi/js-client:2.0.6"},n.setHttpClient=function(){var t=e.create({adapter:r,baseURL:"https://smsapi.io/api",headers:{Accept:"application/json",Authorization:"Bearer "+this.accessToken,"User-Agent":this.getUserAgent()}});return t.interceptors.response.use(w),t},t}();
//# sourceMappingURL=smsapi.cjs.production.min.js.map
